<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>Kanban Board</h1>
                <span class="header-doc-info" id="headerDocInfo">MyTasks | Revision 0.1.4 January 2026</span>
            </div>
            <div class="header-right">
                <button class="btn btn-icon" id="btnManualSave" title="Save">
                    <i class="bi bi-floppy" style="font-size: 20px;"></i>
                    <span>Save</span>
                </button>
                <button class="btn btn-icon" id="btnAddProject" title="Add Project">
                    <i class="bi bi-folder-plus" style="font-size: 20px;"></i>
                    <span>Project</span>
                </button>
                <button class="btn btn-icon" id="btnAddTask" title="Add Task">
                    <i class="bi bi-check-square" style="font-size: 20px;"></i>
                    <span>Task</span>
                </button>
                <button class="btn btn-icon" id="btnSettings" title="Settings">
                    <i class="bi bi-gear" style="font-size: 20px;"></i>
                    <span>Settings</span>
                </button>
            </div>
        </header>

        <!-- Warning Banners -->
        <div class="overdue-banner" id="overdueBanner" style="display: none;">
            <i class="bi bi-exclamation-triangle" style="font-size: 20px;"></i>
            <span id="overdueText">Tasks are overdue!</span>
            <button class="btn-close-warning" id="closeOverdue">&times;</button>
        </div>
        <div class="warning-banner" id="warningBanner" style="display: none;">
            <i class="bi bi-exclamation-triangle" style="font-size: 20px;"></i>
            <span id="warningText">Tasks approaching due date!</span>
            <button class="btn-close-warning" id="closeWarning">&times;</button>
        </div>
        <div class="starting-banner" id="startingBanner" style="display: none;">
            <i class="bi bi-info-circle" style="font-size: 20px;"></i>
            <span id="startingText">Tasks starting soon!</span>
            <button class="btn-close-warning" id="closeStarting">&times;</button>
        </div>

        <!-- Kanban Board -->
        <main class="kanban-board" id="kanbanBoard">
            <!-- Columns will be dynamically generated -->
        </main>
    </div>

    <!-- Project Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="projectModalTitle">New Project</h2>
                <button class="btn-close" id="closeProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm">
                    <input type="hidden" id="projectId">
                    <div class="form-group">
                        <label for="projectTitle">Title *</label>
                        <input type="text" id="projectTitle" required placeholder="Enter project title" maxlength="32">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectPriority">Priority *</label>
                            <select id="projectPriority" required>
                                <option value="1">Low</option>
                                <option value="2">Medium</option>
                                <option value="3">High</option>
                                <option value="4">Urgent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectStatus">Status *</label>
                            <select id="projectStatus" required>
                                <option value="backlog">Backlog</option>
                                <option value="not-started">Not Started</option>
                                <option value="in-progress">In Progress</option>
                                <option value="testing">Testing</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectCategory">Category</label>
                            <select id="projectCategory">
                                <option value="">-- None --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Key Persons</label>
                            <div id="projectKeyPersons" class="checkbox-list"></div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectStartDate">Start Date</label>
                            <input type="date" id="projectStartDate">
                        </div>
                        <div class="form-group">
                            <label for="projectDueDate">Due Date</label>
                            <input type="date" id="projectDueDate">
                        </div>
                    </div>
                    
                    <!-- Task Management Section -->
                    <div class="form-group project-tasks-section">
                        <label>Tasks</label>
                        <div class="project-tasks-input">
                            <input type="text" id="projectTaskTitle" placeholder="Task name *" maxlength="32">
                            <div class="task-date-inputs">
                                <div class="task-date-group">
                                    <label for="projectTaskStartDate">Start Date</label>
                                    <input type="date" id="projectTaskStartDate">
                                </div>
                                <div class="task-date-group">
                                    <label for="projectTaskDueDate">Due Date</label>
                                    <input type="date" id="projectTaskDueDate">
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-primary" id="addProjectTask">Add</button>
                        </div>
                        <div class="project-tasks-list" id="projectTasksList"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectDetails">Details (Markdown supported)</label>
                        <div class="markdown-toggle-container">
                            <button type="button" class="btn btn-sm btn-secondary markdown-toggle" id="projectMarkdownToggle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                Preview
                            </button>
                        </div>
                        <textarea id="projectDetails" rows="5" placeholder="Enter project details..." maxlength="4096"></textarea>
                        <div id="projectMarkdownPreview" class="markdown-preview" style="display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelProject">Cancel</button>
                <button class="btn btn-danger" id="deleteProject" style="display: none;">Delete</button>
                <button class="btn btn-primary" id="saveProject">Save</button>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="taskModalTitle">New Task</h2>
                <button class="btn-close" id="closeTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="taskId">
                    <div class="form-group">
                        <label for="taskTitle">Title *</label>
                        <input type="text" id="taskTitle" required placeholder="Enter task title" maxlength="32">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskProject">Project *</label>
                            <select id="taskProject" required>
                                <option value="">-- Select Project --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskPriority">Priority *</label>
                            <select id="taskPriority" required>
                                <option value="1">Low</option>
                                <option value="2">Medium</option>
                                <option value="3">High</option>
                                <option value="4">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskStartDate">Start Date</label>
                            <input type="date" id="taskStartDate">
                        </div>
                        <div class="form-group">
                            <label for="taskDueDate">Due Date</label>
                            <input type="date" id="taskDueDate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="taskDetails">Details (Markdown supported)</label>
                        <div class="markdown-toggle-container">
                            <button type="button" class="btn btn-sm btn-secondary markdown-toggle" id="taskMarkdownToggle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                Preview
                            </button>
                        </div>
                        <textarea id="taskDetails" rows="5" placeholder="Enter task details..." maxlength="4096"></textarea>
                        <div id="taskMarkdownPreview" class="markdown-preview" style="display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTask">Cancel</button>
                <button class="btn btn-danger" id="deleteTask" style="display: none;">Delete</button>
                <button class="btn btn-primary" id="saveTask">Save</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="btn-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="kanban">Kanban</button>
                    <button class="settings-tab" data-tab="categories">Categories</button>
                    <button class="settings-tab" data-tab="keypersons">Key Persons</button>
                    <button class="settings-tab" data-tab="sync">Sync</button>
                    <button class="settings-tab" data-tab="data">Data</button>
                    <button class="settings-tab" data-tab="info">Info</button>
                </div>
                
                <!-- General Tab -->
                <div class="settings-panel active" id="panel-general">
                    <div class="form-group">
                        <label for="docName">Document Name</label>
                        <input type="text" id="docName" value="MyTasks" placeholder="MyTasks" maxlength="32">
                        <small>Name of this document</small>
                    </div>
                    <div class="form-group">
                        <label for="docAuthor">Author</label>
                        <input type="text" id="docAuthor" value="Me" placeholder="Me" maxlength="32">
                        <small>Author of this document</small>
                    </div>
                    <div class="form-group">
                        <label for="docVersion">Version</label>
                        <input type="text" id="docVersion" value="1.0" placeholder="1.0" maxlength="32">
                        <small>Document version number</small>
                    </div>
                    <div class="form-group">
                        <label for="themeSelect">Theme</label>
                        <div class="theme-buttons">
                            <button class="theme-btn" data-theme="light">Light</button>
                            <button class="theme-btn active" data-theme="dark">Dark</button>
                            <button class="theme-btn" data-theme="keqing">Keqing</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fontSelect">Font</label>
                        <div class="font-buttons">
                            <button class="font-btn active" data-font="default">Default</button>
                            <button class="font-btn" data-font="consolas">Consolas</button>
                            <button class="font-btn" data-font="dyslexic">OpenDyslexic</button>
                        </div>
                    </div>
                </div>
                
                <!-- Kanban Tab -->
                <div class="settings-panel" id="panel-kanban">
                    <div class="form-group">
                        <label for="warningDaysBeforeStart">Warning Days Before Start Date</label>
                        <input type="number" id="warningDaysBeforeStart" min="-1" max="30" value="3">
                        <small>Show notification for tasks/projects starting soon. Set to -1 to disable, 0 for same day only, or X days before start date.</small>
                    </div>
                    <div class="form-group">
                        <label for="warningDays">Warning Days Before Due Date</label>
                        <input type="number" id="warningDays" min="-1" max="30" value="3">
                        <small>Show warning for tasks/projects due soon. Set to -1 to disable, 0 for same day only, or X days before due date.</small>
                    </div>
                    <div class="form-group">
                        <label for="autoDeleteDays">Auto-delete Completed Projects After (Days)</label>
                        <input type="number" id="autoDeleteDays" min="0" max="365" value="0">
                        <small>Set to 0 to disable. Projects with all tasks done will be deleted after this many days.</small>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoMoveProject">
                            <span>Auto-move project when all tasks done</span>
                        </label>
                        <small>When enabled: Project moves to "Done" when all tasks are completed (5/5). If a new task is added, project moves back to first column.</small>
                    </div>
                    
                    <hr style="margin: 24px 0; border: none; border-top: 1px solid var(--border);">
                    
                    <div class="form-group">
                        <label>Kanban Columns (Min: 2, Max: 12)</label>
                        <small style="display: block; margin-bottom: 12px;">Drag to reorder. First column acts as "Start", last column acts as "Done".</small>
                        <div style="display: grid; gap: 12px; margin-bottom: 12px;">
                            <input type="text" id="newColumnName" placeholder="Column name" maxlength="32">
                            <div>
                                <label style="font-size: 0.85rem; margin-bottom: 4px; display: block;">Color:</label>
                                <div class="color-palette" id="columnColorPalette">
                                    <button type="button" class="color-swatch active" data-color="#6b7280" style="background:#6b7280" title="Gray"></button>
                                    <button type="button" class="color-swatch" data-color="#ef4444" style="background:#ef4444" title="Red"></button>
                                    <button type="button" class="color-swatch" data-color="#f97316" style="background:#f97316" title="Orange"></button>
                                    <button type="button" class="color-swatch" data-color="#eab308" style="background:#eab308" title="Yellow"></button>
                                    <button type="button" class="color-swatch" data-color="#84cc16" style="background:#84cc16" title="Lime"></button>
                                    <button type="button" class="color-swatch" data-color="#22c55e" style="background:#22c55e" title="Green"></button>
                                    <button type="button" class="color-swatch" data-color="#14b8a6" style="background:#14b8a6" title="Teal"></button>
                                    <button type="button" class="color-swatch" data-color="#06b6d4" style="background:#06b6d4" title="Cyan"></button>
                                    <button type="button" class="color-swatch" data-color="#3b82f6" style="background:#3b82f6" title="Blue"></button>
                                    <button type="button" class="color-swatch" data-color="#6366f1" style="background:#6366f1" title="Indigo"></button>
                                    <button type="button" class="color-swatch" data-color="#8b5cf6" style="background:#8b5cf6" title="Purple"></button>
                                    <button type="button" class="color-swatch" data-color="#ec4899" style="background:#ec4899" title="Pink"></button>
                                </div>
                            </div>
                            <div>
                                <label style="font-size: 0.85rem; margin-bottom: 4px; display: block;">Icon (optional):</label>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input type="text" id="columnIconSearch" placeholder="Search icons (e.g., circle, check)" style="flex: 1;">
                                    <button type="button" class="btn btn-secondary btn-sm" id="clearColumnIcon">Clear</button>
                                </div>
                                <div id="columnIconPicker" style="display: none; margin-top: 8px; max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 6px; padding: 8px; background: var(--bg-secondary);"></div>
                                <input type="hidden" id="newColumnIcon">
                                <div id="columnIconPreview" style="margin-top: 8px; min-height: 32px;"></div>
                            </div>
                            <button class="btn btn-primary btn-sm" id="addColumn">Add Column</button>
                        </div>
                        <ul class="column-list" id="columnList"></ul>
                    </div>
                </div>
                
                <!-- Categories Tab -->
                <div class="settings-panel" id="panel-categories">
                    <div class="manager-section">
                        <div class="manager-input-row">
                            <input type="text" id="newCategory" placeholder="New category name" maxlength="32">
                        </div>
                        <div class="manager-input-row">
                            <label>Color:</label>
                            <div class="color-palette" id="categoryColorPalette">
                                <button type="button" class="color-swatch active" data-color="#6b7280" style="background:#6b7280" title="Gray"></button>
                                <button type="button" class="color-swatch" data-color="#ef4444" style="background:#ef4444" title="Red"></button>
                                <button type="button" class="color-swatch" data-color="#f97316" style="background:#f97316" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="#eab308" style="background:#eab308" title="Yellow"></button>
                                <button type="button" class="color-swatch" data-color="#84cc16" style="background:#84cc16" title="Lime"></button>
                                <button type="button" class="color-swatch" data-color="#22c55e" style="background:#22c55e" title="Green"></button>
                                <button type="button" class="color-swatch" data-color="#14b8a6" style="background:#14b8a6" title="Teal"></button>
                                <button type="button" class="color-swatch" data-color="#06b6d4" style="background:#06b6d4" title="Cyan"></button>
                                <button type="button" class="color-swatch" data-color="#3b82f6" style="background:#3b82f6" title="Blue"></button>
                                <button type="button" class="color-swatch" data-color="#6366f1" style="background:#6366f1" title="Indigo"></button>
                                <button type="button" class="color-swatch" data-color="#8b5cf6" style="background:#8b5cf6" title="Purple"></button>
                                <button type="button" class="color-swatch" data-color="#ec4899" style="background:#ec4899" title="Pink"></button>
                            </div>
                            <button class="btn btn-primary btn-sm" id="addCategory">Add</button>
                        </div>
                        <ul class="manager-list" id="categoryList"></ul>
                    </div>
                </div>
                
                <!-- Key Persons Tab -->
                <div class="settings-panel" id="panel-keypersons">
                    <div class="manager-section">
                        <div class="manager-input">
                            <input type="text" id="newKeyPerson" placeholder="New key person name" maxlength="32">
                            <button class="btn btn-primary btn-sm" id="addKeyPerson">Add</button>
                        </div>
                        <ul class="manager-list" id="keyPersonList"></ul>
                    </div>
                </div>
                
                <!-- Sync Tab -->
                <div class="settings-panel" id="panel-sync">
                    <div class="data-section">
                        <h3><i class="bi bi-github"></i>    Cross-Device Sync via GitHub Gist</h3>
                        <p style="margin-bottom:12px;color:var(--text-secondary);">Sync your Kanban data across devices using your own GitHub Gist. No server needed - your data stays in your GitHub account.</p>
                        
                        <div class="sync-setup-guide" style="background:var(--bg-secondary);padding:16px;border-radius:8px;margin-bottom:20px;">
                            <strong style="display:block;margin-bottom:8px;">Setup Instructions:</strong>
                            <ol style="margin:0;padding-left:20px;line-height:1.8;">
                                <li>Go to <a href="https://github.com/settings/tokens/new" target="_blank" style="color:var(--accent);">GitHub Token Settings</a></li>
                                <li>Create token with <code style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;">gist</code> scope only</li>
                                <li>Go to <a href="https://gist.github.com" target="_blank" style="color:var(--accent);">gist.github.com</a> and create a <strong>Secret</strong> gist</li>
                                <li>Name file like <code style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;">kanban-sync.json</code> with content <code style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;">{}</code> (you can use any .json name)</li>
                                <li>Copy the Gist ID from URL (e.g., <code style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;">gist.github.com/you/<strong>abc123</strong></code>)</li>
                            </ol>
                        </div>
                        
                        <div class="form-group">
                            <label for="syncGistId">Gist ID</label>
                            <input type="text" id="syncGistId" placeholder="e.g., abc123def456789...">
                        </div>
                        <div class="form-group">
                            <label for="syncGistToken">GitHub Personal Access Token</label>
                            <input type="password" id="syncGistToken" placeholder="ghp_xxxxxxxxxxxx">
                            <small>Token is stored locally and never sent anywhere except GitHub API</small>
                        </div>
                        <div class="form-group">
                            <label for="syncFileName">Sync File Name</label>
                            <input type="text" id="syncFileName" placeholder="kanban-sync.json" value="kanban-sync.json">
                            <small>Name of the JSON file in your Gist (allows multiple kanban instances)</small>
                        </div>
                        <div class="form-group">
                            <label for="autoSaveInterval">Auto Save Interval</label>
                            <select id="autoSaveInterval">
                                <option value="0">Disabled</option>
                                <option value="1">1 minute</option>
                                <option value="5">5 minutes</option>
                                <option value="15">15 minutes</option>
                                <option value="30">30 minutes</option>
                            </select>
                            <small>Automatically sync to GitHub Gist at selected interval (0 = disabled)</small>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" id="testSyncConnection" style="margin-right:8px;">Test Connection</button>
                            <button class="btn btn-primary" id="saveSyncSettings">Save Settings</button>
                        </div>
                        <div id="syncStatus" style="margin-top:12px;padding:10px;border-radius:6px;display:none;"></div>
                    </div>
                    
                    <div class="data-section" id="syncActionsSection" style="display:none;">
                        <h3>Sync Actions</h3>
                        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px;">
                            <button class="btn btn-primary" id="syncPush">
                                <i class="bi bi-cloud-upload" style="margin-right:6px;font-size:16px;"></i>
                                Push to Cloud
                            </button>
                            <div style="display:flex;gap:5px;flex-direction:column;">
                                <button class="btn btn-secondary" id="syncPullReplace">
                                    <i class="bi bi-cloud-download" style="margin-right:6px;font-size:16px;"></i>
                                    Pull (Replace)
                                </button>
                                <button class="btn btn-secondary" id="syncPullMerge">
                                    <i class="bi bi-cloud-download" style="margin-right:6px;font-size:16px;"></i>
                                    Pull (Merge)
                                </button>
                            </div>
                        </div>
                        <div id="syncInfo" style="color:var(--text-secondary);font-size:0.9em;">
                            <p id="lastSyncTime">Last sync: Never</p>
                        </div>
                    </div>
                    
                    <div class="data-section data-danger">
                        <h3>Clear Sync Settings</h3>
                        <p>Remove stored Gist credentials from this device.</p>
                        <button class="btn btn-danger" id="clearSyncSettings">Clear Sync Settings</button>
                    </div>
                </div>
                
                <!-- Data Tab -->
                <div class="settings-panel" id="panel-data">
                    <div class="data-section">
                        <h3>Storage Usage</h3>
                        <div id="storageInfo" class="storage-info">
                            <div class="storage-bar">
                                <div class="storage-fill" id="storageFill"></div>
                            </div>
                            <p id="storageText" class="storage-text">Calculating...</p>
                        </div>
                    </div>
                    <div class="data-section">
                        <h3>Export Data</h3>
                        <p>Download all your projects and tasks as a JSON file.</p>
                        <button class="btn btn-primary" id="exportData">Export Data</button>
                    </div>
                    <div class="data-section">
                        <h3>Import Data</h3>
                        <p>Import projects and tasks from a JSON file.</p>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                        <div style="display:flex;gap:10px;flex-wrap:wrap;">
                            <button class="btn btn-secondary" id="importDataReplace">Import (Replace)</button>
                            <button class="btn btn-secondary" id="importDataMerge">Import (Merge)</button>
                        </div>
                    </div>
                    <div class="data-section data-danger">
                        <h3>Clear All Data</h3>
                        <p>This will permanently delete all projects, tasks, categories, and key persons.</p>
                        <button class="btn btn-danger" id="clearAllData">Clear All Data</button>
                    </div>
                </div>
                
                <!-- Info Tab -->
                <div class="settings-panel" id="panel-info">
                    <div class="data-section">
                        <h3>About</h3>
                        <p>Kanban Board is a simple and intuitive project management tool that helps you organize tasks and track progress. Manage your projects with customizable columns, categories, and key persons. All data is stored locally in your browser with optional cloud sync (Required GitHub account)</p>
                    </div>
                    <div class="data-section">
                        <h3>Version</h3>
                        <p>Version 0.1.6b (January 2026)</p>
                    </div>
                    <div class="data-section">
                        <h3>Documentation</h3>
                        <p><a href="docs.html" target="_blank">View Documentation</a></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeSettings">Done</button>
            </div>
        </div>
    </div>

    <!-- Detail View Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailTitle">Details</h2>
                <button class="btn-close" id="closeDetailModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-content" id="detailContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeDetail">Close</button>
                <button class="btn btn-accent" id="addTaskFromDetail" style="display: none;">Add Task</button>
                <button class="btn btn-primary" id="editDetail">Edit</button>
            </div>
        </div>
    </div>

    <!-- Edit Key Person Modal -->
    <div class="modal" id="editKeyPersonModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Edit Key Person</h2>
                <button class="btn-close" id="closeEditKeyPerson">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editKeyPersonName">Name</label>
                    <input type="text" id="editKeyPersonName" placeholder="Enter key person name" maxlength="32">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditKeyPerson">Cancel</button>
                <button class="btn btn-primary" id="saveEditKeyPerson">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div class="modal" id="editCategoryModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Edit Category</h2>
                <button class="btn-close" id="closeEditCategory">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editCategoryName">Name</label>
                    <input type="text" id="editCategoryName" placeholder="Enter category name" maxlength="32">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="color-palette" id="editCategoryColorPalette">
                        <button type="button" class="color-swatch" data-color="#6b7280" style="background:#6b7280" title="Gray"></button>
                        <button type="button" class="color-swatch" data-color="#ef4444" style="background:#ef4444" title="Red"></button>
                        <button type="button" class="color-swatch" data-color="#f97316" style="background:#f97316" title="Orange"></button>
                        <button type="button" class="color-swatch" data-color="#eab308" style="background:#eab308" title="Yellow"></button>
                        <button type="button" class="color-swatch" data-color="#84cc16" style="background:#84cc16" title="Lime"></button>
                        <button type="button" class="color-swatch" data-color="#22c55e" style="background:#22c55e" title="Green"></button>
                        <button type="button" class="color-swatch" data-color="#14b8a6" style="background:#14b8a6" title="Teal"></button>
                        <button type="button" class="color-swatch" data-color="#06b6d4" style="background:#06b6d4" title="Cyan"></button>
                        <button type="button" class="color-swatch" data-color="#3b82f6" style="background:#3b82f6" title="Blue"></button>
                        <button type="button" class="color-swatch" data-color="#6366f1" style="background:#6366f1" title="Indigo"></button>
                        <button type="button" class="color-swatch" data-color="#8b5cf6" style="background:#8b5cf6" title="Purple"></button>
                        <button type="button" class="color-swatch" data-color="#ec4899" style="background:#ec4899" title="Pink"></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditCategory">Cancel</button>
                <button class="btn btn-primary" id="saveEditCategory">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit Column Modal -->
    <div class="modal" id="editColumnModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Edit Column</h2>
                <button class="btn-close" id="closeEditColumn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editColumnId">
                <div class="form-group">
                    <label for="editColumnName">Column Name</label>
                    <input type="text" id="editColumnName" placeholder="Column name" maxlength="32">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="color-palette" id="editColumnColorPalette">
                        <button type="button" class="color-swatch" data-color="#6b7280" style="background:#6b7280" title="Gray"></button>
                        <button type="button" class="color-swatch" data-color="#ef4444" style="background:#ef4444" title="Red"></button>
                        <button type="button" class="color-swatch" data-color="#f97316" style="background:#f97316" title="Orange"></button>
                        <button type="button" class="color-swatch" data-color="#eab308" style="background:#eab308" title="Yellow"></button>
                        <button type="button" class="color-swatch" data-color="#84cc16" style="background:#84cc16" title="Lime"></button>
                        <button type="button" class="color-swatch" data-color="#22c55e" style="background:#22c55e" title="Green"></button>
                        <button type="button" class="color-swatch" data-color="#14b8a6" style="background:#14b8a6" title="Teal"></button>
                        <button type="button" class="color-swatch" data-color="#06b6d4" style="background:#06b6d4" title="Cyan"></button>
                        <button type="button" class="color-swatch" data-color="#3b82f6" style="background:#3b82f6" title="Blue"></button>
                        <button type="button" class="color-swatch" data-color="#6366f1" style="background:#6366f1" title="Indigo"></button>
                        <button type="button" class="color-swatch" data-color="#8b5cf6" style="background:#8b5cf6" title="Purple"></button>
                        <button type="button" class="color-swatch" data-color="#ec4899" style="background:#ec4899" title="Pink"></button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Icon (optional)</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="text" id="editColumnIconSearch" placeholder="Search icons (e.g., circle, check)" style="flex: 1;">
                        <button type="button" class="btn btn-secondary btn-sm" id="clearEditColumnIcon">Clear</button>
                    </div>
                    <div id="editColumnIconPicker" style="display: none; margin-top: 8px; max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 6px; padding: 8px; background: var(--bg-secondary);"></div>
                    <input type="hidden" id="editColumnIcon">
                    <div id="editColumnIconPreview" style="margin-top: 8px; min-height: 32px;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditColumn">Cancel</button>
                <button class="btn btn-primary" id="saveEditColumn">Save</button>
            </div>
        </div>
    </div>

    <!-- Clear Data Confirmation Modal -->
    <div class="modal" id="clearDataModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Clear All Data</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: var(--danger); font-weight: 500;">⚠️ This action cannot be undone!</p>
                <p style="margin-bottom: 16px;">All projects, tasks, categories, and key persons will be permanently deleted.</p>
                <p style="margin-bottom: 8px;">To confirm, please type your document name: <strong id="confirmDocName"></strong></p>
                <div class="form-group">
                    <input type="text" id="clearDataConfirmInput" placeholder="Type document name here" maxlength="32">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelClearData">Cancel</button>
                <button class="btn btn-danger" id="confirmClearData" disabled>Clear All Data</button>
            </div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div class="modal" id="confirmModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Confirm</h2>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="confirmCancel">Cancel</button>
                <button class="btn btn-danger" id="confirmOk">Delete</button>
            </div>
        </div>
    </div>

    <!-- Clear Sync Confirmation Modal -->
    <div class="modal" id="clearSyncModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Clear Sync Settings</h2>
                <button class="btn-close" id="closeClearSyncModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Remove sync credentials from this device?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelClearSync">Cancel</button>
                <button class="btn btn-danger" id="confirmClearSync">Clear Settings</button>
            </div>
        </div>
    </div>

    <!-- Sync Check Modal -->
    <div class="modal" id="syncCheckModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Sync Available</h2>
                <button class="btn-close" id="closeSyncCheckModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="syncCheckMessage">Checking sync status...</p>
                <div id="syncCheckDetails" style="margin-top:15px;font-size:0.9em;color:var(--text-secondary);"></div>
            </div>
            <div class="modal-footer" id="syncCheckActions" style="display:none;">
                <button class="btn btn-secondary" id="syncCheckNo">
                    <i class="bi bi-x-circle"></i>
                    No
                </button>
                <button class="btn btn-primary" id="syncCheckPush">
                    <i class="bi bi-cloud-upload"></i>
                    Push
                </button>
                <button class="btn btn-accent" id="syncCheckPullMerge">
                    <i class="bi bi-cloud-download"></i>
                    Pull (Merge)
                </button>
                <button class="btn btn-danger" id="syncCheckPullReplace">
                    <i class="bi bi-cloud-download-fill"></i>
                    Pull (Replace)
                </button>
            </div>
        </div>
    </div>

    <!-- Push Confirm Modal -->
    <div class="modal" id="pushConfirmModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Push to Cloud</h2>
                <button class="btn-close" id="closePushConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Upload your local data to GitHub Gist?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPush">Cancel</button>
                <button class="btn btn-primary" id="confirmPush">Push</button>
            </div>
        </div>
    </div>

    <!-- Pull Replace Confirm Modal -->
    <div class="modal" id="pullReplaceConfirmModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Pull (Replace)</h2>
                <button class="btn-close" id="closePullReplaceConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>This will overwrite your local data with cloud data. Continue?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPullReplace">Cancel</button>
                <button class="btn btn-danger" id="confirmPullReplace">Replace</button>
            </div>
        </div>
    </div>

    <!-- Pull Merge Confirm Modal -->
    <div class="modal" id="pullMergeConfirmModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Pull (Merge)</h2>
                <button class="btn-close" id="closePullMergeConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>This will merge cloud data with your local data. Conflicts will be resolved using cloud data. Continue?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPullMerge">Cancel</button>
                <button class="btn btn-primary" id="confirmPullMerge">Merge</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script src="app-part1-data.js"></script>
    <script src="app-part2-ui.js"></script>
    <script src="app-part3-events.js"></script>
    <script src="app-part4-sync.js"></script>
</body>
</html>
